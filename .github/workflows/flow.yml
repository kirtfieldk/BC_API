# THIS IS WHAT MY GITHUB ACTION LOOKS LIKE ATM
name: Push images to Dockerhub and deploy on ELastic Beanstalk
on: 
 push:
  branches:
    - master
jobs:
  build_docker_images:
    name: build docker images
    runs-on: [ubuntu-latest]
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: set up QEMU
        uses: docker/setup-qemu-actions@v1
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-actions@v1
      - name: Login to dockerhub
        uses: docker/login-action@v1
        with:
          username: ${{secrets.DOCKERHUB_USERNAME}}
          password: ${{secrets.DOCKERHUB_TOKEN}}
      - name: Deploy to Elastic Beanstalk
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-it: ${{secrets.AWS_ACCESS_KEY}}
          aws-secrete-access-key: ${{secrets.AWS_ACCESS_SECRET_KEY}}
          aws-region: us-east-1
      - name: Build and push Client
        run: docker build -t keithkfield/blog-server -f ./Server/Dockerfile .   
      - name: Push built image to dockerhub
        run: docker -t keithkfield/blog-server keithkfield/blog-server:latest 
      - name: push
        run: docker push keithkfield/blog-server